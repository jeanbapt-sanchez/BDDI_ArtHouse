<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Souffle</title>
</head>
<body>
    <h1>Yoooo, souffle sur ton tel pour voir</h1>
    <p>coucou</p>

    <div class="circle" style="height: 40px; width: 40px; background: red; border-radius:50px;">

    </div>

    <script>
        let audioCtx;
        let circle = document.querySelector('.circle')
       if(navigator.mediaDevices.getUserMedia){
            console.log('getUserMedia supported')

            const constraints = { audio : true}
            let chunks = [];

            let onSuccess = function(stream) {
                const mediaRecorder = new MediaRecorder(stream)
                visualize(stream)
                mediaRecorder.ondataavailable = function(e) {
                    chunks.push(e.data);
                }
            }


            let onError = () => {
                console.log('The following error occured: ' + err);
            }
           navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError)
       }
    
        function visualize(stream) {
            if(!audioCtx) {
                audioCtx = new AudioContext();
            }

            const source = audioCtx.createMediaStreamSource(stream);

            const analyser = audioCtx.createAnalyser();
            analyser.fftSize = 2048;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            source.connect(analyser);
            let progressionAudioAnim = 0
            function update() {
                requestAnimationFrame(update)

                analyser.getByteTimeDomainData(dataArray);
                // console.log(dataArray, bufferLength)
                console.log(dataArray[1], progressionAudioAnim)

                if(dataArray[1] > 190){
                    progressionAudioAnim++
                }
            
                circle.style.transform = `scale(${dataArray[1] / 4})`
            }
            update()
            //analyser.connect(audioCtx.destination);
}
    </script>
</body>
</html>